from Bio.Blast.Applications import NcbiblastnCommandline
from Bio.Blast import NCBIXML

def blast_primer(query_address,db_address,out_address1,evalue=0.0001,identity=18):
    blastn_cline = NcbiblastnCommandline(query=query_address,db=db_address,evalue=0.0001, outfmt=5,out=out_address1)
    stout,stderr=blastn_cline()
    result_handle = open(out_address1)
    blast_record = NCBIXML.read(result_handle)
    E_VALUE_THRESH = evalue  # set E_value or other parameter and judge if exist
    Identities = identity  # set identity for alignments,for primer design:length of primer-2 is recommended
    count = 0 # count number of blast hits
    name_list = []
    for alignment in blast_record.alignments:
        for hsp in alignment.hsps:
            if hsp.expect < E_VALUE_THRESH and hsp.identities > Identities:
                count += 1
                name_list.append(alignment.title)
                # print('****Alignment****')
                # print('sequence:', alignment.title)
                # print('length:', alignment.length)
                # print('identity:', hsp.identities)
                # print('e value:', hsp.expect)
                # print(hsp.query[0:75] + '...')
                # print(hsp.match[0:75] + '...')
                # print(hsp.sbjct[0:75] + '...')
    return count,name_list
