import primer3
from pandas import DataFrame


def design_primer(seq_args, global_args, out_address):
    primer3_result = primer3.bindings.designPrimers(seq_args, global_args)
    print('Succeeded. A total of ', primer3_result['PRIMER_PAIR_NUM_RETURNED'], 'primer pair(s) are designed.',
          '\nFor forward primer: ', primer3_result['PRIMER_LEFT_EXPLAIN'], '\nFor reverse primer: ',
          primer3_result['PRIMER_RIGHT_EXPLAIN'], '\nFor primer pairs: ', primer3_result['PRIMER_PAIR_EXPLAIN'])
    primer3_result_table_dict = {}
    for i in range(primer3_result["PRIMER_PAIR_NUM_RETURNED"]):
        primer_id = str(i)
        for key in primer3_result:
            if '_' + primer_id + '_' in key:
                info_tag = key.replace("_" + primer_id, "")
                try:
                    primer3_result_table_dict[info_tag]
                except:
                    primer3_result_table_dict[info_tag] = []
                finally:
                    primer3_result_table_dict[info_tag].append(primer3_result[key])
    index = []
    for i in range(primer3_result["PRIMER_PAIR_NUM_RETURNED"]):
        index.append("PRIMER_PAIR_" + str(i + 1))
    primer3_result_df = DataFrame(primer3_result_table_dict, index=index)
    primer3_result_df = primer3_result_df.T
    primer3_result_df.to_csv(out_address)
    print('Primer pair(s) Designed: \n', primer3_result_df)
    return primer3_result_df
